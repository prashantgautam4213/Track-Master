{
  "entities": {
    "Train": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Train",
      "type": "object",
      "description": "Represents a train with its details.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the Train entity."
        },
        "trainNumber": {
          "type": "string",
          "description": "The unique number assigned to the train."
        },
        "name": {
          "type": "string",
          "description": "The name of the train."
        },
        "sourceStationId": {
          "type": "string",
          "description": "Reference to the source Station. (Relationship: Station 1:N Train)"
        },
        "destinationStationId": {
          "type": "string",
          "description": "Reference to the destination Station. (Relationship: Station 1:N Train)"
        },
        "departureTime": {
          "type": "string",
          "description": "The departure time of the train.",
          "format": "date-time"
        },
        "arrivalTime": {
          "type": "string",
          "description": "The arrival time of the train.",
          "format": "date-time"
        },
        "availableSeats": {
          "type": "number",
          "description": "The number of seats currently available on the train."
        },
        "fare": {
          "type": "number",
          "description": "The fare for traveling on this train."
        }
      },
      "required": [
        "id",
        "trainNumber",
        "name",
        "sourceStationId",
        "destinationStationId",
        "departureTime",
        "arrivalTime",
        "availableSeats",
        "fare"
      ]
    },
    "Station": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Station",
      "type": "object",
      "description": "Represents a train station.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the Station entity."
        },
        "name": {
          "type": "string",
          "description": "The name of the train station."
        },
        "code": {
          "type": "string",
          "description": "A short code representing the station."
        },
        "location": {
          "type": "string",
          "description": "The geographical location of the station."
        }
      },
      "required": [
        "id",
        "name",
        "code",
        "location"
      ]
    },
    "Booking": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Booking",
      "type": "object",
      "description": "Represents a train booking made by a user.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the Booking entity."
        },
        "userId": {
          "type": "string",
          "description": "Reference to the User who made the booking. (Relationship: User 1:N Booking)"
        },
        "trainId": {
          "type": "string",
          "description": "Reference to the Train that was booked. (Relationship: Train 1:N Booking)"
        },
        "bookingDate": {
          "type": "string",
          "description": "The date when the booking was made.",
          "format": "date-time"
        },
        "numberOfSeats": {
          "type": "number",
          "description": "The number of seats booked."
        },
        "totalFare": {
          "type": "number",
          "description": "The total fare for the booking."
        }
      },
      "required": [
        "id",
        "userId",
        "trainId",
        "bookingDate",
        "numberOfSeats",
        "totalFare"
      ]
    }
  },
  "auth": {
    "providers": [
      "password",
      "anonymous"
    ]
  },
  "firestore": {
    "structure": [
      {
        "path": "/users/{userId}",
        "definition": {
          "entityName": "user",
          "schema": {
            "$ref": "#/backend/entities/User"
          },
          "description": "Stores user profile information.  User data is private and accessible only to the user and admins.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier for the user."
            }
          ]
        }
      },
      {
        "path": "/trains/{trainId}",
        "definition": {
          "entityName": "Train",
          "schema": {
            "$ref": "#/backend/entities/Train"
          },
          "description": "Stores train details. Accessible to all users for viewing train schedules and details. Train creation, update, and deletion are restricted to admins.",
          "params": [
            {
              "name": "trainId",
              "description": "The unique identifier for the train."
            }
          ]
        }
      },
      {
        "path": "/stations/{stationId}",
        "definition": {
          "entityName": "Station",
          "schema": {
            "$ref": "#/backend/entities/Station"
          },
          "description": "Stores station information. Accessible to all users for searching and viewing station details.",
          "params": [
            {
              "name": "stationId",
              "description": "The unique identifier for the station."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/bookings/{bookingId}",
        "definition": {
          "entityName": "Booking",
          "schema": {
            "$ref": "#/backend/entities/Booking"
          },
          "description": "Stores booking information for a specific user. Bookings are private and accessible only to the user and admins.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier for the user."
            },
            {
              "name": "bookingId",
              "description": "The unique identifier for the booking."
            }
          ]
        }
      },
      {
        "path": "/roles_admin/{userId}",
        "definition": {
          "entityName": "adminRole",
          "schema": {
            "$ref": "#/backend/entities/Role"
          },
          "description": "Marks a user as an administrator. The existence of a document in this collection grants admin privileges.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier for the user with admin privileges."
            }
          ]
        }
      }
    ],
    "reasoning": "The Firestore structure is designed to support a train ticket reservation system with user authentication and admin privileges. It emphasizes authorization independence and clear access control.  User data is stored under `/users/{userId}`. Trains and stations are stored in top-level collections for easy listing and searching. Bookings are associated with individual users under `/users/{userId}/bookings/{bookingId}`. This structure avoids hierarchical authorization dependencies by not requiring `get()` calls to parent documents. Specifically, the `userId` in the `/users/{userId}/bookings/{bookingId}` path inherently grants the user access to their own bookings (path-based ownership). No denormalization is needed because the `userId` is already present on the booking documents and can be used in security rules to restrict access. The top-level `trains` and `stations` collections support listing train schedules and station details. Admin privileges, such as adding, updating, and removing trains, would be enforced through a dedicated `roles_admin` collection, where the existence of a document for a user signifies admin status. Security rules will use `exists()` to check this collection.\n\nThis design supports the required QAPs by:\n\n1.  **List Operations:** The separation of `trains` and `stations` into top-level collections ensures efficient listing of these entities without requiring complex queries or security rules.\n2.  **User-Specific Data:** The `/users/{userId}/bookings/{bookingId}` structure allows users to securely manage and view their booking history.\n3.  **Admin Privileges:** The `/roles_admin/{uid}` collection enables secure enforcement of admin privileges for train management."
  }
}